- hosts: localhost
  tasks:
    - name: install pre-req
      become: true
      become_user: root
      apt:
        state: present
        name:
         - make
         - cmake
         - libtool
         - libtool-bin
         - gettext
         - autoconf
         - automake
         - g++
         - pkg-config
         - unzip
         - curl
         - doxygen


    - name: clone neovim
      ansible.builtin.git:
        repo: https://github.com/neovim/neovim.git
        dest: /tmp/neovim
        version: release-0.5

    - name: build nvim
      become: true 
      community.general.make:
        chdir: /tmp/neovim
        jobs: 4
        params:
          CMAKE_BUILD_TYPE: Release

    - name: install nvim
      become: true 
      community.general.make:
        chdir: /tmp/neovim
        target: install
        params:

    - name: copy .nvim
      ansible.builtin.copy:
        src: ../nvim/init.vim
        dest: ~/.config/nvim/init.vim
        backup: yes

    - name: setup vimplug
      shell: curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
      register: result

    - name: install plugins
      shell: nvim +PlugInstall +qall
      register: result
